<!DOCTYPE html>
<html lang="en" class="h-full dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Audio Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: {"50":"#f0f9ff","100":"#e0f2fe","200":"#bae6fd","300":"#7dd3fc","400":"#38bdf8","500":"#0ea5e9","600":"#0284c7","700":"#0369a1","800":"#075985","900":"#0c4a6e"},
                    }
                }
            }
        }
    </script>
</head>
<body class="h-full bg-gradient-to-br from-primary-100 to-primary-200 dark:from-gray-800 dark:to-gray-900 transition-all duration-300 font-sans">
    <div class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-md w-full space-y-8 bg-white dark:bg-gray-800 p-10 rounded-3xl shadow-2xl transition-all duration-300 hover:shadow-3xl">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-primary-600 dark:text-primary-400 mb-4">Quran Audio Explorer</h1>
                <p class="text-gray-600 dark:text-gray-300 text-lg">Discover and download beautiful Quranic recitations</p>
            </div>

            <div class="mt-10 space-y-8">
                <div>
                    <label for="qariSelect" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">
                        <i class="fas fa-user-circle mr-2"></i>Select Qari
                    </label>
                    <select id="qariSelect" class="block w-full px-4 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200 hover:border-primary-400">
                    </select>
                </div>

                <div>
                    <label for="surahSearch" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">
                        <i class="fas fa-book-open mr-2"></i>Search and Select Surah
                    </label>
                    <input type="text" id="surahSearch" class="block w-full px-4 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200 hover:border-primary-400" placeholder="Type to search surah">
                    <select id="surahSelect" class="mt-2 block w-full px-4 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200 hover:border-primary-400">
                    </select>
                </div>

                <div>
                    <label for="ayahInput" class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">
                        <i class="fas fa-list-ol mr-2"></i>Ayah Number (optional)
                    </label>
                    <input type="number" id="ayahInput" class="block w-full px-4 py-3 text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200 hover:border-primary-400" placeholder="Leave empty for full surah">
                </div>

                <div>
                    <audio id="audioPreview" controls class="w-full mt-2 rounded-lg">
                        Your browser does not support the audio element.
                    </audio>
                </div>

                <div class="flex items-center justify-between">
                    <button id="downloadAudioBtn" class="flex-grow py-3 px-6 border border-transparent rounded-lg shadow-sm text-lg font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200 transform hover:scale-105">
                        <i class="fas fa-download mr-2"></i>Download Audio
                    </button>
                    <label for="darkModeToggle" class="flex items-center cursor-pointer ml-6">
                        <div class="relative">
                            <input type="checkbox" id="darkModeToggle" class="sr-only">
                            <div class="w-12 h-6 bg-gray-400 rounded-full shadow-inner"></div>
                            <div class="dot absolute w-8 h-8 bg-white rounded-full shadow -left-1 -top-1 transition-all duration-300 transform scale-110"></div>
                        </div>
                        <div class="ml-3 text-gray-700 dark:text-gray-300 font-medium text-lg">
                            <i class="fas fa-moon"></i>
                        </div>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const qariSelect = document.getElementById("qariSelect");
        const surahSelect = document.getElementById("surahSelect");
        const ayahInput = document.getElementById("ayahInput");
        const downloadAudioBtn = document.getElementById("downloadAudioBtn");
        const audioPreview = document.getElementById("audioPreview");
        const darkModeToggle = document.getElementById("darkModeToggle");
        const surahSearch = document.getElementById("surahSearch");

        const qariOptions = {
            "01": "Abdullah Al-Juhany",
            "02": "Abdul Muhsin Al-Qasim",
            "03": "Abdurrahman As-Sudais",
            "04": "Ibrahim Al-Dossari",
            "05": "Mishari Rashid Al-Afasy",
        };

        let surahData = [];

        // Populate qari options
        for (let [value, name] of Object.entries(qariOptions)) {
            const option = document.createElement("option");
            option.value = value;
            option.textContent = name;
            qariSelect.appendChild(option);
        }

        // Fetch and populate surah options
        fetch("./surat/surat.json")
            .then(response => response.json())
            .then(data => {
                if (data.code === 200) {
                    surahData = data.data;
                    populateSurahOptions(surahData);
                }
            })
            .catch(error => console.error("Error fetching surah list:", error));

        function populateSurahOptions(surahs) {
            surahSelect.innerHTML = '';
            surahs.forEach(surah => {
                const option = document.createElement("option");
                option.value = surah.nomor;
                option.textContent = `${surah.nomor}. ${surah.namaLatin}`;
                surahSelect.appendChild(option);
            });
        }

        // Add search functionality
        surahSearch.addEventListener("input", function() {
            const searchTerm = this.value.toLowerCase();
            const filteredSurahs = surahData.filter(surah => 
                surah.namaLatin.toLowerCase().includes(searchTerm) ||
                surah.nomor.toString().includes(searchTerm)
            );
            populateSurahOptions(filteredSurahs);
        });

        // Add event listeners for audio preview
        qariSelect.addEventListener("change", updateAudioPreview);
        surahSelect.addEventListener("change", updateAudioPreview);
        ayahInput.addEventListener("input", updateAudioPreview);

        function updateAudioPreview() {
            const qari = qariSelect.value;
            const surahNumber = surahSelect.value;
            const ayah = ayahInput.value.trim();

            if (!surahNumber) {
                audioPreview.src = "";
                return;
            }

            if (ayah === "") {
                // Preview surah lengkap
                const selectedSurah = surahData.find(s => s.nomor == surahNumber);
                if (selectedSurah && selectedSurah.audioFull[qari]) {
                    audioPreview.src = selectedSurah.audioFull[qari];
                }
            } else {
                // Preview ayat spesifik
                fetch(`./surat/${surahNumber}.json`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.code === 200) {
                            const ayahData = data.data.ayat.find(a => a.nomorAyat == ayah);
                            if (ayahData && ayahData.audio[qari]) {
                                audioPreview.src = ayahData.audio[qari];
                            } else {
                                audioPreview.src = "";
                            }
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching ayah data:", error);
                        audioPreview.src = "";
                    });
            }
        }

        // Download audio
        downloadAudioBtn.addEventListener("click", () => {
            const audioUrl = audioPreview.src;
            if (audioUrl) {
                const qari = qariSelect.value;
                const qariName = qariOptions[qari].replace(/\s+/g, '-').toLowerCase();
                const surahNumber = surahSelect.value;
                const surahName = surahData.find(s => s.nomor == surahNumber).namaLatin.replace(/\s+/g, '-').toLowerCase();
                const ayah = ayahInput.value.trim();
                
                let fileName = ayah === "" 
                    ? `surat-${surahName}-full-${qariName}.mp3`
                    : `surat-${surahName}-ayat-${ayah}-${qariName}.mp3`;

                const downloadLink = document.createElement("a");
                downloadLink.href = audioUrl;
                downloadLink.download = fileName;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
            } else {
                alert("Please select valid audio before downloading.");
            }
        });

        // Dark mode toggle
        darkModeToggle.addEventListener("change", () => {
            document.documentElement.classList.toggle("dark");
        });
    });
    </script>
</body>
</html>